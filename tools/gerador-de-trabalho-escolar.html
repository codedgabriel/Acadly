<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Trabalhos Escolares | Acadly</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Times+New+Roman&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --primary-light: #4895ef;
            --secondary-color: #3f37c9;
            --background-dark: #f8f9fa;
            --background-light: #ffffff;
            --background-lighter: #f1f3f5;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --border-color: #dee2e6;
            --success-color: #4cc9f0;
            --danger-color: #f72585;
            --warning-color: #f8961e;
            --info-color: #4895ef;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --transition: all 0.2s ease-in-out;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-dark);
            color: var(--text-primary);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }

        @media (min-width: 992px) {
            .main-container {
                flex-direction: row;
            }
        }

        .editor-container, .preview-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            height: calc(100vh - 60px);
        }

        .editor-container {
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }

        .preview-container {
            background-color: white;
            border-left: 1px solid var(--border-color);
            display: none;
        }

        @media (min-width: 992px) {
            .preview-container {
                display: block !important;
                flex: 0 0 400px;
            }
        }

        .container {
            padding: 20px;
        }

        h1, h2, h3 {
            font-weight: 600;
            color: var(--primary-color);
        }

        h1 {
            text-align: center;
            margin: 20px 0;
            font-size: 2rem;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding-top: 15px;
        }

        .logo svg {
            width: 28px;
            height: 28px;
        }

        .form-container {
            background: var(--background-light);
            padding: 25px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .input-hint {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 6px;
            font-style: italic;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-sizing: border-box;
            font-family: 'Times New Roman', Times, serif;
            background-color: var(--background-light);
            color: var(--text-primary);
            transition: var(--transition);
            font-size: 1rem;
            box-shadow: var(--shadow-sm);
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 140px;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background-color: var(--background-lighter);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--border-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #e3176a;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e68a00;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-info {
            background-color: var(--info-color);
            color: white;
        }

        .btn-info:hover {
            background-color: #3a7bc8;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #3ab0d9;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .section {
            background: var(--background-light);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
            position: relative;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .section:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .section-title {
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title svg {
            width: 20px;
            height: 20px;
        }

        .remove-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 6px 10px;
            font-size: 0.8rem;
            min-width: auto;
        }

        .image-preview {
            max-width: 100%;
            max-height: 250px;
            margin: 15px 0;
            border-radius: var(--radius-md);
            display: none;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .author-container {
            margin-bottom: 20px;
        }

        .authors-list {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .author-item {
            display: inline-flex;
            align-items: center;
            padding: 8px 15px;
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(67, 97, 238, 0.3);
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .author-item:hover {
            background-color: rgba(67, 97, 238, 0.2);
        }

        .remove-author {
            background-color: transparent;
            color: var(--danger-color);
            border: none;
            border-radius: 50%;
            padding: 4px;
            cursor: pointer;
            margin-left: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .remove-author:hover {
            background-color: rgba(247, 37, 133, 0.1);
        }

        .remove-author svg {
            width: 14px;
            height: 14px;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
        }

        .footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .section-content {
            margin-top: 20px;
        }

        .content-option {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--background-lighter);
            border-radius: var(--radius-md);
            border: 1px dashed var(--border-color);
            transition: var(--transition);
        }

        .content-option:hover {
            border-color: var(--primary-color);
        }

        .content-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        .content-option input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
            cursor: pointer;
        }

        .list-items {
            margin-top: 15px;
        }

        .list-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .list-item input {
            flex-grow: 1;
            padding: 10px 15px;
            background-color: var(--background-light);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .list-item input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .sections-container {
            margin-top: 30px;
        }

        .section-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 1rem;
            background-color: var(--background-lighter);
            border-radius: var(--radius-md);
            border: 2px dashed var(--border-color);
            margin: 20px 0;
            transition: var(--transition);
        }

        .empty-state:hover {
            border-color: var(--primary-color);
        }

        .empty-state svg {
            width: 40px;
            height: 40px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-primary);
            color: var(--background-light);
            text-align: center;
            border-radius: var(--radius-md);
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.8rem;
            box-shadow: var(--shadow-md);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: var(--radius-md);
            color: white;
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            font-size: 1rem;
            max-width: 90%;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }
        
        .toast-success {
            background-color: var(--success-color);
        }
        
        .toast-error {
            background-color: var(--danger-color);
        }
        
        .toast-warning {
            background-color: var(--warning-color);
        }

        .toast-info {
            background-color: var(--info-color);
        }

        /* Preview styles */
        .preview-page {
            width: 100%;
            min-height: 297mm;
            background: white;
            margin-bottom: 10px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            padding: 20mm;
            box-sizing: border-box;
            position: relative;
            break-after: page;
        }

        .preview-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .preview-subtitle {
            text-align: center;
            font-size: 14px;
            font-style: italic;
            margin-bottom: 30px;
        }

        .preview-authors {
            text-align: center;
            margin-bottom: 40px;
        }

        .preview-author {
            display: block;
            margin-bottom: 5px;
        }

        .preview-section-title {
            font-weight: bold;
            margin: 20px 0 10px 0;
            font-size: 16px;
        }

        .preview-text {
            text-align: justify;
            margin-bottom: 15px;
            text-indent: 30px;
        }

        .preview-list {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        .preview-list-item {
            margin-bottom: 5px;
        }

        .preview-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 15px auto;
            border-radius: 4px;
        }

        .preview-image-caption {
            text-align: center;
            font-style: italic;
            font-size: 12px;
            margin-bottom: 20px;
        }

        .preview-date {
            text-align: center;
            margin-top: 50px;
            font-size: 12px;
        }

        .preview-page-number {
            position: absolute;
            bottom: 10mm;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 12px;
        }

        /* Preview controls */
        .preview-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 100;
            transition: var(--transition);
            display: none;
        }

        .preview-toggle:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        .preview-toggle svg {
            width: 24px;
            height: 24px;
        }

        /* Mobile improvements */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.6rem;
                margin: 15px 0;
            }

            .logo {
                font-size: 1.6rem;
            }

            .form-container {
                padding: 20px;
            }

            button {
                padding: 12px;
                font-size: 0.95rem;
                min-width: 100%;
            }

            .button-group {
                flex-direction: column;
                gap: 10px;
            }

            .section {
                padding: 18px;
            }

            textarea {
                min-height: 100px;
            }

            .preview-toggle {
                display: flex;
            }

            .preview-container {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1000;
                background-color: white;
                padding: 20px;
                overflow-y: auto;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            }

            .preview-container.active {
                transform: translateX(0);
            }

            .preview-close {
                position: absolute;
                top: 15px;
                right: 15px;
                background: var(--danger-color);
                color: white;
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 1001;
            }
        }

        /* Animações */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* Floating action button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 100;
            transition: var(--transition);
        }

        .fab:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.3);
        }

        .fab svg {
            width: 24px;
            height: 24px;
        }

        /* Progress bar */
        .progress-container {
            width: 100%;
            height: 5px;
            background-color: rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 0 3px 3px 0;
        }

        /* Input group */
        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-group input {
            flex-grow: 1;
        }

        .input-group button {
            flex-shrink: 0;
            min-width: auto;
            padding: 12px 15px;
        }

        /* Section counter */
        .section-counter {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: var(--primary-color);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Help text */
        .help-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Required field */
        .required {
            color: var(--danger-color);
            font-size: 0.8rem;
            margin-left: 5px;
        }

        /* Drag handle */
        .drag-handle {
            cursor: move;
            padding: 5px;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .drag-handle:hover {
            color: var(--primary-color);
        }
    </style>
</head>

<body>
    <div class="progress-container" id="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div class="main-container">
        <div class="editor-container">
            <div class="container">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    Acadly
                </div>
                <h1>Gerador de Trabalhos Escolares</h1>

                <div class="form-container">
                    <div class="form-group">
                        <label for="escola">
                            <i class="fas fa-school"></i>
                            Nome da Instituição
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="escola" placeholder="Ex: Escola Estadual Professor João Silva" required>
                        <p class="input-hint">O nome completo da sua escola ou faculdade</p>
                    </div>

                    <div class="form-group">
                        <label for="autor">
                            <i class="fas fa-user-graduate"></i>
                            Autores do Trabalho
                            <span class="required">*</span>
                        </label>
                        <div class="author-container">
                            <div class="input-group">
                                <input type="text" id="autor" placeholder="Ex: Maria Oliveira Santos">
                                <button type="button" class="btn-primary" onclick="adicionarAutor()">
                                    <i class="fas fa-plus"></i>
                                    Adicionar
                                </button>
                            </div>
                            <p class="input-hint">Adicione todos os autores do trabalho (pressione Enter para adicionar)</p>
                        </div>
                        <div class="authors-list" id="authors-list">
                            <div class="empty-state" id="empty-authors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="8.5" cy="7" r="4"></circle>
                                    <line x1="20" y1="8" x2="20" y2="14"></line>
                                    <line x1="23" y1="11" x2="17" y2="11"></line>
                                </svg>
                                <p>Nenhum autor adicionado</p>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="titulo">
                            <i class="fas fa-heading"></i>
                            Título do Trabalho
                            <span class="required">*</span>
                        </label>
                        <input type="text" id="titulo" placeholder="Ex: A Importância da Reciclagem no Século XXI" required>
                        <p class="input-hint">O título principal do seu trabalho</p>
                    </div>

                    <div class="form-group">
                        <label for="subtitulo">
                            <i class="fas fa-subscript"></i>
                            Subtítulo (opcional)
                        </label>
                        <input type="text" id="subtitulo" placeholder="Ex: Um estudo de caso na cidade de São Paulo">
                        <p class="input-hint">Subtítulo que aparecerá abaixo do título principal</p>
                    </div>

                    <h2 style="color: var(--primary-color); margin: 30px 0 20px; display: flex; align-items: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 10px;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Seções do Trabalho
                        <span class="tooltip">
                            <i class="fas fa-info-circle" style="color: var(--text-secondary);"></i>
                            <span class="tooltiptext">Adicione todas as seções do seu trabalho como Introdução, Desenvolvimento, Conclusão, etc.</span>
                        </span>
                    </h2>

                    <div class="sections-container" id="sections-container">
                        <div class="empty-state" id="empty-sections">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                            <p>Nenhuma seção adicionada</p>
                            <p style="margin-top: 10px; font-size: 0.9rem;">Clique no botão abaixo para adicionar sua primeira seção</p>
                        </div>
                    </div>

                    <button type="button" class="btn-primary" onclick="adicionarSecao()" style="margin-top: 20px;">
                        <i class="fas fa-plus"></i>
                        Adicionar Seção
                    </button>

                    <div class="button-group">
                        <button class="btn-success" onclick="gerarPDF()">
                            <i class="fas fa-file-pdf"></i>
                            Gerar PDF
                        </button>
                        <button type="button" class="btn-warning" onclick="limparFormulario()">
                            <i class="fas fa-trash-alt"></i>
                            Limpar Tudo
                        </button>
                        <button type="button" class="btn-info" onclick="mostrarAjuda()">
                            <i class="fas fa-question-circle"></i>
                            Ajuda
                        </button>
                        <button type="button" class="btn-secondary" onclick="togglePreview()" id="preview-btn">
                            <i class="fas fa-eye"></i>
                            Pré-visualizar
                        </button>
                    </div>
                </div>

                <div class="footer">
                    Parte do projeto <a href="https://acadly.codegabriel.com.br" target="_blank">Acadly</a> - Gerador de trabalhos acadêmicos
                </div>
            </div>
        </div>

        <div class="preview-container" id="preview-container">
            <button class="preview-close" onclick="togglePreview()" id="preview-close-btn">
                <i class="fas fa-times"></i>
            </button>
            <div id="preview-content">
                <!-- As páginas serão geradas dinamicamente aqui -->
            </div>
        </div>
    </div>

    <div class="fab" onclick="adicionarSecao()" title="Adicionar seção">
        <i class="fas fa-plus"></i>
    </div>

    <div class="preview-toggle" onclick="togglePreview()" id="mobile-preview-toggle">
        <i class="fas fa-eye"></i>
    </div>

    <script>
        // Inicializa o jsPDF
        const { jsPDF } = window.jspdf;

        // Variáveis para armazenar dados
        let autores = [];
        let secoes = [];

        // Adicionar autor à lista
        function adicionarAutor() {
            const autorInput = document.getElementById('autor');
            const autor = autorInput.value.trim();

            if (autor) {
                autores.push(autor);
                autorInput.value = '';
                atualizarListaAutores();
                autorInput.focus();
                showToast('Autor adicionado!', 'success');
                atualizarPreview();
            } else {
                showToast('Por favor, insira o nome do autor.', 'error');
            }
        }

        // Permitir adicionar autor com Enter
        document.getElementById('autor').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                adicionarAutor();
            }
        });

        // Remover autor da lista
        function removerAutor(index) {
            autores.splice(index, 1);
            atualizarListaAutores();
            showToast('Autor removido.', 'warning');
            atualizarPreview();
        }

        // Atualizar lista de autores na UI
        function atualizarListaAutores() {
            const authorsList = document.getElementById('authors-list');
            const emptyState = document.getElementById('empty-authors');

            if (emptyState && emptyState.parentNode === authorsList) {
                authorsList.removeChild(emptyState);
            }

            if (autores.length === 0) {
                if (!document.getElementById('empty-authors')) {
                    const newEmptyState = document.createElement('div');
                    newEmptyState.className = 'empty-state';
                    newEmptyState.id = 'empty-authors';
                    newEmptyState.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="8.5" cy="7" r="4"></circle>
                            <line x1="20" y1="8" x2="20" y2="14"></line>
                            <line x1="23" y1="11" x2="17" y2="11"></line>
                        </svg>
                        <p>Nenhum autor adicionado</p>
                    `;
                    authorsList.appendChild(newEmptyState);
                }
                return;
            }

            authorsList.innerHTML = '';

            autores.forEach((autor, index) => {
                const authorItem = document.createElement('div');
                authorItem.className = 'author-item';
                authorItem.innerHTML = `
                    <span class="author-name">${autor}</span>
                    <button class="remove-author" onclick="removerAutor(${index})" title="Remover autor">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                authorsList.appendChild(authorItem);
            });
        }

        // Adicionar nova seção
        function adicionarSecao() {
            const sectionId = Date.now();
            const sectionsContainer = document.getElementById('sections-container');
            const emptyState = document.getElementById('empty-sections');

            if (emptyState && emptyState.parentNode === sectionsContainer) {
                sectionsContainer.removeChild(emptyState);
            }

            const sectionCount = document.querySelectorAll('.section').length + 1;

            const sectionHTML = `
                <div class="section" id="section-${sectionId}">
                    <div class="section-counter">${sectionCount}</div>
                    <h3 class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Nova Seção
                    </h3>
                    <button class="remove-btn btn-danger" onclick="removerSecao('${sectionId}')" title="Remover seção">
                        <i class="fas fa-trash-alt"></i>
                        Remover
                    </button>
                    
                    <div class="section-content">
                        <div class="form-group">
                            <label for="titulo-secao-${sectionId}">
                                <i class="fas fa-heading"></i>
                                Título da Seção
                                <span class="required">*</span>
                            </label>
                            <input type="text" id="titulo-secao-${sectionId}" placeholder="Ex: Introdução" class="section-title-input" required oninput="atualizarPreview()">
                            <p class="input-hint">Título que aparecerá no trabalho</p>
                        </div>
                        
                        <div class="content-option">
                            <label>
                                <input type="checkbox" id="add-texto-${sectionId}" checked onchange="atualizarPreview()">
                                <i class="fas fa-align-left"></i>
                                Adicionar Texto
                            </label>
                            <textarea id="texto-secao-${sectionId}" placeholder="Digite o conteúdo desta seção..." style="margin-top: 10px;" oninput="atualizarPreview()"></textarea>
                            <p class="help-text">
                                <i class="fas fa-info-circle"></i>
                                Use parágrafos separados por linhas vazias para melhor formatação
                            </p>
                        </div>
                        
                        <div class="content-option">
                            <label>
                                <input type="checkbox" id="add-imagem-${sectionId}" onchange="atualizarPreview()">
                                <i class="fas fa-image"></i>
                                Adicionar Imagem
                            </label>
                            <div id="imagem-container-${sectionId}" style="display: none; margin-top: 10px;">
                                <input type="file" id="imagem-secao-${sectionId}" accept="image/*" style="margin-bottom: 10px;" onchange="atualizarPreview()">
                                <img id="image-preview-${sectionId}" class="image-preview" alt="Pré-visualização da imagem">
                                <p class="help-text">
                                    <i class="fas fa-info-circle"></i>
                                    Formatos suportados: JPG, PNG (Tamanho máximo: 5MB)
                                </p>
                            </div>
                        </div>
                        
                        <div class="content-option">
                            <label>
                                <input type="checkbox" id="add-lista-${sectionId}" onchange="atualizarPreview()">
                                <i class="fas fa-list-ul"></i>
                                Adicionar Lista
                            </label>
                            <div id="lista-container-${sectionId}" style="display: none; margin-top: 10px;">
                                <div class="list-items" id="lista-items-${sectionId}">
                                    <!-- Itens da lista serão adicionados aqui -->
                                </div>
                                <button type="button" class="btn-secondary" onclick="adicionarItemLista('${sectionId}')" style="margin-top: 10px;">
                                    <i class="fas fa-plus"></i>
                                    Adicionar Item
                                </button>
                                <p class="help-text">
                                    <i class="fas fa-info-circle"></i>
                                    Itens serão exibidos como lista com marcadores
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            sectionsContainer.insertAdjacentHTML('beforeend', sectionHTML);

            // Configurar eventos para os checkboxes
            document.getElementById(`add-imagem-${sectionId}`).addEventListener('change', function() {
                document.getElementById(`imagem-container-${sectionId}`).style.display = this.checked ? 'block' : 'none';
                atualizarPreview();
            });

            document.getElementById(`add-lista-${sectionId}`).addEventListener('change', function() {
                document.getElementById(`lista-container-${sectionId}`).style.display = this.checked ? 'block' : 'none';
                atualizarPreview();
            });

            // Configurar preview de imagem
            document.getElementById(`imagem-secao-${sectionId}`).addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        showToast('A imagem deve ter no máximo 5MB', 'error');
                        this.value = '';
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const preview = document.getElementById(`image-preview-${sectionId}`);
                        preview.src = event.target.result;
                        preview.style.display = 'block';
                        atualizarPreview();
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Adicionar primeiro item de lista
            adicionarItemLista(sectionId);

            // Rolagem suave para a nova seção
            setTimeout(() => {
                document.getElementById(`section-${sectionId}`).scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);

            showToast('Nova seção adicionada!', 'success');
            atualizarPreview();
        }

        // Remover seção
        function removerSecao(sectionId) {
            if (confirm('Tem certeza que deseja remover esta seção e todo o seu conteúdo?')) {
                const section = document.getElementById(`section-${sectionId}`);
                section.parentNode.removeChild(section);

                const sectionsContainer = document.getElementById('sections-container');
                if (sectionsContainer.children.length === 0) {
                    sectionsContainer.appendChild(document.getElementById('empty-sections'));
                }

                // Atualizar contadores de seção
                document.querySelectorAll('.section').forEach((section, index) => {
                    section.querySelector('.section-counter').textContent = index + 1;
                });

                showToast('Seção removida.', 'warning');
                atualizarPreview();
            }
        }

        // Adicionar item à lista
        function adicionarItemLista(sectionId) {
            const itemId = Date.now();
            const listaItems = document.getElementById(`lista-items-${sectionId}`);

            const itemHTML = `
                <div class="list-item" id="item-${itemId}">
                    <input type="text" placeholder="Digite um item da lista" oninput="atualizarPreview()">
                    <button type="button" class="btn-danger" onclick="removerItemLista('${itemId}')" title="Remover item">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            `;

            listaItems.insertAdjacentHTML('beforeend', itemHTML);

            // Focar no novo input
            setTimeout(() => {
                document.querySelector(`#item-${itemId} input`).focus();
            }, 50);

            atualizarPreview();
        }

        // Remover item da lista
        function removerItemLista(itemId) {
            const item = document.getElementById(`item-${itemId}`);
            if (item) {
                item.remove();
                atualizarPreview();
            }
        }

        // Limpar formulário
        function limparFormulario() {
            if (confirm('Tem certeza que deseja limpar todo o formulário? Todos os dados serão perdidos.')) {
                document.getElementById('escola').value = '';
                document.getElementById('autor').value = '';
                document.getElementById('titulo').value = '';
                document.getElementById('subtitulo').value = '';

                // Limpar seções
                const sectionsContainer = document.getElementById('sections-container');
                sectionsContainer.innerHTML = '';
                sectionsContainer.appendChild(document.getElementById('empty-sections'));

                // Limpar autores
                autores = [];
                atualizarListaAutores();

                showToast('Formulário limpo com sucesso.', 'success');
                atualizarPreview();
            }
        }

        // Mostrar ajuda
        function mostrarAjuda() {
            alert('Como usar o Gerador de Trabalhos:\n\n1. Preencha os dados básicos (instituição, autores, título)\n2. Adicione seções ao seu trabalho\n3. Em cada seção, adicione texto, imagens ou listas\n4. Clique em "Gerar PDF" para baixar seu trabalho formatado\n\nDica: Você pode adicionar quantas seções precisar!');
        }

        // Mostrar toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            // Adicionar ícone baseado no tipo
            let icon;
            switch(type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'warning':
                    icon = '<i class="fas fa-exclamation-triangle"></i>';
                    break;
                default:
                    icon = '<i class="fas fa-info-circle"></i>';
            }
            
            toast.innerHTML = `${icon} ${message}`;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 3000);
        }

        // Atualizar barra de progresso
        function updateProgress(progress) {
            const progressBar = document.getElementById('progress-bar');
            const progressContainer = document.getElementById('progress-container');
            
            if (progress > 0) {
                progressContainer.style.display = 'block';
                progressBar.style.width = `${progress}%`;
            } else {
                progressContainer.style.display = 'none';
            }
        }

        // Alternar pré-visualização
        function togglePreview() {
            const previewContainer = document.getElementById('preview-container');
            const isMobile = window.innerWidth < 992;
            
            if (isMobile) {
                previewContainer.classList.toggle('active');
                if (previewContainer.classList.contains('active')) {
                    atualizarPreview();
                }
            } else {
                if (previewContainer.style.display === 'none' || previewContainer.style.display === '') {
                    previewContainer.style.display = 'block';
                    atualizarPreview();
                } else {
                    previewContainer.style.display = 'none';
                }
            }
        }

        // Atualizar pré-visualização
        function atualizarPreview() {
            const escola = document.getElementById('escola').value;
            const titulo = document.getElementById('titulo').value;
            const subtitulo = document.getElementById('subtitulo').value;
            
            const previewContent = document.getElementById('preview-content');
            previewContent.innerHTML = '';
            
            // Criar capa
            const coverPage = document.createElement('div');
            coverPage.className = 'preview-page';
            
            // Adicionar conteúdo da capa
            let coverHTML = `
                <div class="preview-title">${titulo || "Título do Trabalho"}</div>
                ${subtitulo ? `<div class="preview-subtitle">${subtitulo}</div>` : ''}
                <div class="preview-authors">
                    ${autores.length > 0 ? 
                        `<div style="font-weight: bold; margin-bottom: 10px;">${autores.length > 1 ? 'Autores:' : 'Autor:'}</div>
                        ${autores.map(autor => `<div class="preview-author">${autor}</div>`).join('')}`
                        : '<div class="preview-author">Autor não informado</div>'}
                </div>
                <div class="preview-date">
                    ${new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' })}
                </div>
                <div class="preview-page-number">1</div>
            `;
            
            coverPage.innerHTML = coverHTML;
            previewContent.appendChild(coverPage);
            
            // Criar páginas de conteúdo
            const contentPage = document.createElement('div');
            contentPage.className = 'preview-page';
            let contentHTML = '';
            let currentPageHeight = 0;
            const maxPageHeight = 297 - 40; // 297mm (A4) - margens
            
            // Adicionar título do trabalho na primeira página de conteúdo
            contentHTML += `
                <div class="preview-section-title" style="font-size: 14px; margin-bottom: 15px;">${titulo || "Título do Trabalho"}</div>
                ${subtitulo ? `<div class="preview-text" style="font-style: italic; margin-bottom: 20px;">${subtitulo}</div>` : ''}
            `;
            currentPageHeight += 50; // Altura estimada do título e subtítulo
            
            // Processar seções
            const sectionElements = document.querySelectorAll('.section');
            
            if (sectionElements.length === 0) {
                contentHTML += '<div class="preview-text">Adicione seções ao seu trabalho para visualizar o conteúdo aqui.</div>';
            } else {
                sectionElements.forEach(section => {
                    const sectionId = section.id.split('-')[1];
                    const tituloSecao = document.getElementById(`titulo-secao-${sectionId}`).value || "Nova Seção";
                    
                    // Verificar se precisa de nova página
                    if (currentPageHeight > maxPageHeight - 50) {
                        contentPage.innerHTML = contentHTML + '<div class="preview-page-number">' + (previewContent.children.length + 1) + '</div>';
                        previewContent.appendChild(contentPage);
                        
                        // Criar nova página
                        contentPage = document.createElement('div');
                        contentPage.className = 'preview-page';
                        contentHTML = '';
                        currentPageHeight = 0;
                    }
                    
                    // Adicionar título da seção
                    contentHTML += `<div class="preview-section-title">${tituloSecao}</div>`;
                    currentPageHeight += 20;
                    
                    // Adicionar texto se estiver ativo
                    if (document.getElementById(`add-texto-${sectionId}`).checked) {
                        const texto = document.getElementById(`texto-secao-${sectionId}`).value;
                        if (texto) {
                            const paragraphs = texto.split('\n').filter(p => p.trim() !== '');
                            for (const paragrafo of paragraphs) {
                                // Verificar se precisa de nova página
                                if (currentPageHeight > maxPageHeight - 30) {
                                    contentPage.innerHTML = contentHTML + '<div class="preview-page-number">' + (previewContent.children.length + 1) + '</div>';
                                    previewContent.appendChild(contentPage);
                                    
                                    // Criar nova página
                                    contentPage = document.createElement('div');
                                    contentPage.className = 'preview-page';
                                    contentHTML = '';
                                    currentPageHeight = 0;
                                }
                                
                                contentHTML += `<div class="preview-text">${paragrafo}</div>`;
                                currentPageHeight += 20; // Altura estimada por parágrafo
                            }
                        }
                    }
                    
                    // Adicionar lista se estiver ativo
                    if (document.getElementById(`add-lista-${sectionId}`).checked) {
                        const listaItems = document.getElementById(`lista-items-${sectionId}`).querySelectorAll('.list-item input');
                        if (listaItems.length > 0) {
                            // Verificar se precisa de nova página
                            if (currentPageHeight > maxPageHeight - 30) {
                                contentPage.innerHTML = contentHTML + '<div class="preview-page-number">' + (previewContent.children.length + 1) + '</div>';
                                previewContent.appendChild(contentPage);
                                
                                // Criar nova página
                                contentPage = document.createElement('div');
                                contentPage.className = 'preview-page';
                                contentHTML = '';
                                currentPageHeight = 0;
                            }
                            
                            contentHTML += '<div class="preview-list">';
                            listaItems.forEach(item => {
                                if (item.value) {
                                    // Verificar se precisa de nova página para cada item
                                    if (currentPageHeight > maxPageHeight - 20) {
                                        contentHTML += '</div>'; // Fechar lista
                                        contentPage.innerHTML = contentHTML + '<div class="preview-page-number">' + (previewContent.children.length + 1) + '</div>';
                                        previewContent.appendChild(contentPage);
                                        
                                        // Criar nova página
                                        contentPage = document.createElement('div');
                                        contentPage.className = 'preview-page';
                                        contentHTML = '<div class="preview-list">';
                                        currentPageHeight = 20;
                                    }
                                    
                                    contentHTML += `<div class="preview-list-item">• ${item.value}</div>`;
                                    currentPageHeight += 15; // Altura estimada por item
                                }
                            });
                            contentHTML += '</div>';
                        }
                    }
                    
                    // Adicionar imagem se estiver ativo
                    if (document.getElementById(`add-imagem-${sectionId}`).checked) {
                        const imagemInput = document.getElementById(`imagem-secao-${sectionId}`);
                        if (imagemInput.files.length > 0) {
                            const preview = document.getElementById(`image-preview-${sectionId}`);
                            if (preview.src) {
                                // Verificar se precisa de nova página (considerando altura da imagem)
                                if (currentPageHeight > maxPageHeight - 100) {
                                    contentPage.innerHTML = contentHTML + '<div class="preview-page-number">' + (previewContent.children.length + 1) + '</div>';
                                    previewContent.appendChild(contentPage);
                                    
                                    // Criar nova página
                                    contentPage = document.createElement('div');
                                    contentPage.className = 'preview-page';
                                    contentHTML = '';
                                    currentPageHeight = 0;
                                }
                                
                                contentHTML += `
                                    <img src="${preview.src}" class="preview-image">
                                    <div class="preview-image-caption">Figura: ${imagemInput.files[0].name}</div>
                                `;
                                currentPageHeight += 120; // Altura estimada para imagem + legenda
                            }
                        }
                    }
                });
            }
            
            // Adicionar última página
            contentPage.innerHTML = contentHTML + '<div class="preview-page-number">' + (previewContent.children.length + 1) + '</div>';
            previewContent.appendChild(contentPage);
        }

        // Gerar PDF com formatação ABNT
        function gerarPDF() {
            // Obter os valores dos campos
            const escola = document.getElementById('escola').value;
            const titulo = document.getElementById('titulo').value;
            const subtitulo = document.getElementById('subtitulo').value;

            // Validação dos campos obrigatórios
            if (!escola) {
                showToast('Por favor, informe o nome da instituição.', 'error');
                document.getElementById('escola').focus();
                return;
            }

            if (!titulo) {
                showToast('Por favor, informe o título do trabalho.', 'error');
                document.getElementById('titulo').focus();
                return;
            }

            // Verificar se há autores
            if (autores.length === 0) {
                showToast('Por favor, adicione pelo menos um autor.', 'error');
                document.getElementById('autor').focus();
                return;
            }

            // Obter todas as seções
            const sectionElements = document.querySelectorAll('.section');

            // Verificar se há seções
            if (sectionElements.length === 0) {
                showToast('Por favor, adicione pelo menos uma seção.', 'error');
                return;
            }

            // Verificar se todas as seções têm título
            let todasSecoesValidas = true;
            sectionElements.forEach(section => {
                const sectionId = section.id.split('-')[1];
                const tituloSecao = document.getElementById(`titulo-secao-${sectionId}`).value;
                if (!tituloSecao) {
                    todasSecoesValidas = false;
                    document.getElementById(`titulo-secao-${sectionId}`).focus();
                }
            });

            if (!todasSecoesValidas) {
                showToast('Por favor, preencha o título de todas as seções.', 'error');
                return;
            }

            // Coletar dados das seções
            const secoes = [];
            let totalImagens = 0;
            let imagensCarregadas = 0;

            // Contar imagens para processamento
            sectionElements.forEach(section => {
                const sectionId = section.id.split('-')[1];
                if (document.getElementById(`add-imagem-${sectionId}`).checked) {
                    const imagemInput = document.getElementById(`imagem-secao-${sectionId}`);
                    if (imagemInput.files.length > 0) {
                        totalImagens++;
                    }
                }
            });

            updateProgress(10);
            showToast('Preparando documento...', 'info');

            const promises = [];

            // Processar cada seção
            sectionElements.forEach((section, index) => {
                const sectionId = section.id.split('-')[1];
                const tituloSecao = document.getElementById(`titulo-secao-${sectionId}`).value;

                const secao = {
                    titulo: tituloSecao,
                    conteudo: [],
                    ordem: index
                };

                // Texto
                if (document.getElementById(`add-texto-${sectionId}`).checked) {
                    const texto = document.getElementById(`texto-secao-${sectionId}`).value;
                    if (texto) {
                        secao.conteudo.push({
                            tipo: 'texto',
                            valor: texto
                        });
                    }
                }

                // Lista
                if (document.getElementById(`add-lista-${sectionId}`).checked) {
                    const itens = [];
                    const listaItems = document.getElementById(`lista-items-${sectionId}`).querySelectorAll('.list-item input');
                    listaItems.forEach(item => {
                        if (item.value) {
                            itens.push(item.value);
                        }
                    });

                    if (itens.length > 0) {
                        secao.conteudo.push({
                            tipo: 'lista',
                            valor: itens
                        });
                    }
                }

                // Imagem
                if (document.getElementById(`add-imagem-${sectionId}`).checked) {
                    const imagemInput = document.getElementById(`imagem-secao-${sectionId}`);
                    if (imagemInput.files.length > 0) {
                        const promise = new Promise((resolve) => {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                secao.conteudo.push({
                                    tipo: 'imagem',
                                    valor: event.target.result,
                                    nome: imagemInput.files[0].name
                                });
                                imagensCarregadas++;
                                updateProgress(10 + (imagensCarregadas / totalImagens * 80));
                                resolve();
                            };
                            reader.readAsDataURL(imagemInput.files[0]);
                        });
                        promises.push(promise);
                    }
                }

                secoes.push(secao);
            });

            function processarSecoesEPDF() {
                updateProgress(90);
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const margin = {
                    left: 30,
                    right: 20,
                    top: 30,
                    bottom: 20
                };

                const pageWidth = 210 - margin.left - margin.right;
                let y = margin.top;

                // Capa
                pdf.setFont('helvetica', 'bold');
                pdf.setFontSize(16);
                const escolaLines = pdf.splitTextToSize(escola.toUpperCase(), pageWidth);
                escolaLines.forEach((line, index) => {
                    pdf.text(line, 105, y + (index * 7), { align: 'center' });
                });
                y += escolaLines.length * 7 + 15;

                pdf.setFontSize(18);
                const tituloLines = pdf.splitTextToSize(titulo.toUpperCase(), pageWidth);
                tituloLines.forEach((line, index) => {
                    pdf.text(line, 105, y + (index * 8), { align: 'center' });
                });
                y += tituloLines.length * 8 + 5;

                if (subtitulo) {
                    pdf.setFontSize(14);
                    pdf.setFont('helvetica', 'normal');
                    const subtituloLines = pdf.splitTextToSize(subtitulo, pageWidth);
                    subtituloLines.forEach((line, index) => {
                        pdf.text(line, 105, y + (index * 6), { align: 'center' });
                    });
                    y += subtituloLines.length * 6 + 10;
                }

                pdf.setFontSize(12);
                const autoresText = autores.length > 1 ? 'Autores:' : 'Autor:';
                pdf.text(autoresText, 105, y, { align: 'center' });
                y += 7;

                pdf.setFont('helvetica', 'normal');
                autores.forEach(autor => {
                    const autorLines = pdf.splitTextToSize(autor, pageWidth);
                    autorLines.forEach((line, index) => {
                        pdf.text(line, 105, y + (index * 6), { align: 'center' });
                    });
                    y += autorLines.length * 6;
                });

                const dataAtual = new Date().toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });

                y = 250;
                pdf.text(dataAtual, 105, y, { align: 'center' });

                // Conteúdo
                pdf.addPage();
                y = margin.top;
                pdf.setFont('times', 'normal');
                pdf.setFontSize(12);

                // Título do trabalho
                pdf.setFontSize(14);
                pdf.setFont('times', 'bold');
                const tituloTrabalhoLines = pdf.splitTextToSize(titulo, pageWidth);
                tituloTrabalhoLines.forEach((line, index) => {
                    pdf.text(line, margin.left, y + (index * 7));
                });
                y += tituloTrabalhoLines.length * 7 + 5;

                if (subtitulo) {
                    pdf.setFontSize(12);
                    pdf.setFont('times', 'italic');
                    const subtituloTrabalhoLines = pdf.splitTextToSize(subtitulo, pageWidth);
                    subtituloTrabalhoLines.forEach((line, index) => {
                        pdf.text(line, margin.left, y + (index * 6));
                    });
                    y += subtituloTrabalhoLines.length * 6 + 10;
                }

                // Seções
                secoes.sort((a, b) => a.ordem - b.ordem).forEach(secao => {
                    if (y > 270) {
                        pdf.addPage();
                        y = margin.top;
                    }

                    // Título da seção
                    pdf.setFontSize(12);
                    pdf.setFont('times', 'bold');
                    const tituloSecaoLines = pdf.splitTextToSize(secao.titulo, pageWidth);
                    tituloSecaoLines.forEach((line, index) => {
                        pdf.text(line, margin.left, y + (index * 6));
                    });
                    y += tituloSecaoLines.length * 6 + 5;

                    // Conteúdo da seção
                    pdf.setFont('times', 'normal');

                    secao.conteudo.forEach(item => {
                        if (y > 270) {
                            pdf.addPage();
                            y = margin.top;
                        }

                        switch (item.tipo) {
                            case 'texto':
                                const paragrafos = item.valor.split('\n').filter(p => p.trim() !== '');
                                for (const paragrafo of paragrafos) {
                                    if (y > 270) {
                                        pdf.addPage();
                                        y = margin.top;
                                    }

                                    const lines = pdf.splitTextToSize(paragrafo, pageWidth);
                                    pdf.text('    ' + lines[0], margin.left, y);
                                    y += 6;

                                    for (let i = 1; i < lines.length; i++) {
                                        if (y > 270) {
                                            pdf.addPage();
                                            y = margin.top;
                                        }
                                        pdf.text(lines[i], margin.left, y);
                                        y += 6;
                                    }
                                    y += 4;
                                }
                                break;

                            case 'imagem':
                                try {
                                    const imgProps = pdf.getImageProperties(item.valor);
                                    const width = Math.min(pageWidth, imgProps.width * 0.2);
                                    const height = (imgProps.height * width) / imgProps.width;

                                    if (y + height > 270) {
                                        pdf.addPage();
                                        y = margin.top;
                                    }

                                    pdf.addImage(item.valor, 'JPEG', (210 - width) / 2, y, width, height);
                                    y += height + 10;

                                    // Legenda da imagem (opcional)
                                    pdf.setFontSize(10);
                                    pdf.text(`Figura: ${item.nome}`, 105, y, { align: 'center' });
                                    y += 6;
                                    pdf.setFontSize(12);
                                } catch (e) {
                                    console.error('Erro ao adicionar imagem:', e);
                                }
                                break;

                            case 'lista':
                                item.valor.forEach(itemLista => {
                                    if (y > 270) {
                                        pdf.addPage();
                                        y = margin.top;
                                    }

                                    const itemLines = pdf.splitTextToSize(`• ${itemLista}`, pageWidth - 10);
                                    itemLines.forEach((line, i) => {
                                        if (i === 0) {
                                            pdf.text(line, margin.left, y);
                                        } else {
                                            pdf.text(line, margin.left + 5, y);
                                        }
                                        y += 6;
                                    });
                                });
                                y += 5;
                                break;
                        }
                    });

                    y += 10;
                });

                // Número de páginas
                const totalPages = pdf.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    pdf.setPage(i);
                    pdf.setFontSize(10);
                    pdf.text(`${i}`, 105, 287, { align: 'center' });
                }

                updateProgress(100);
                setTimeout(() => {
                    updateProgress(0);
                    pdf.save(`trabalho-${titulo.toLowerCase().replace(/\s+/g, '-')}.pdf`);
                    showToast('PDF gerado com sucesso!', 'success');
                }, 500);
            }

            // Processar
            if (promises.length > 0) {
                Promise.all(promises).then(() => {
                    processarSecoesEPDF();
                }).catch(error => {
                    console.error('Erro ao carregar imagens:', error);
                    updateProgress(0);
                    showToast('Erro ao processar imagens', 'error');
                });
            } else {
                processarSecoesEPDF();
            }
        }

        // Configurar eventos para atualizar a pré-visualização
        document.getElementById('escola').addEventListener('input', atualizarPreview);
        document.getElementById('titulo').addEventListener('input', atualizarPreview);
        document.getElementById('subtitulo').addEventListener('input', atualizarPreview);

        // Inicializar lista de autores
        atualizarListaAutores();

        // Mostrar mensagem de boas-vindas
        setTimeout(() => {
            showToast('Bem-vindo ao Gerador de Trabalhos Acadly! Comece adicionando suas seções.', 'success');
            atualizarPreview();
        }, 1000);
    </script>
</body>
</html>